-- [[ –º–µ–Ω—è–π —ç—Ç–∏ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ –¥–ª—è –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏–∏ ]]
getgenv().Optimization = {
    state = true, -- –≤–∫–ª/–≤—ã–∫–ª
    hide_screen = true, -- –≤—ã–∫–ª—é—á–∞–µ—Ç –ø—Ä–æ—Ä–∏—Å–æ–≤–∫—É –≥—Ä–∞—Ñ–∏–∫–∏, –±—É—Å—Ç–∏—Ç –∂–µ—Å—Ç–æ—á–∞–π—à–µ —Ñ–ø—Å (–≤–∫–ª/–≤—ã–∫–ª)
    fps = 3
};

-- –ù–∞—Å—Ç—Ä–æ–π–∫–∞ —Å–µ—Ä–≤–µ—Ä—Ö–æ–ø–∞
getgenv().ServerHopSettings = {
    interval = 15, -- 15 —Å–µ–∫—É–Ω–¥
    last_hop_time = os.time() - 20, -- –°—Ä–∞–∑—É –Ω–∞—á–∏–Ω–∞–µ–º —Å –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ—Å—Ç–∏ —Ö–æ–ø–∞
    use_random_offset = true, -- –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –ª–∏ —Ä–∞–Ω–¥–æ–º–Ω—É—é –∑–∞–¥–µ—Ä–∂–∫—É –ø–µ—Ä–µ–¥ —Ö–æ–ø–æ–º
    min_players = 2, -- –º–∏–Ω–∏–º–∞–ª—å–Ω–æ–µ –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –∏–≥—Ä–æ–∫–æ–≤ –≤ —Å–µ—Ä–≤–µ—Ä–µ –¥–ª—è –ø–µ—Ä–µ—Ö–æ–¥–∞
    max_players = 10, -- –º–∞–∫—Å–∏–º–∞–ª—å–Ω–æ–µ –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –∏–≥—Ä–æ–∫–æ–≤ –≤ —Å–µ—Ä–≤–µ—Ä–µ –¥–ª—è –ø–µ—Ä–µ—Ö–æ–¥–∞ (–∏–∑ 50)
    force_hop = true, -- –ø—Ä–∏–Ω—É–¥–∏—Ç–µ–ª—å–Ω—ã–π —Ö–æ–ø, –¥–∞–∂–µ –µ—Å–ª–∏ –æ–±—ã—á–Ω–∞—è –ø—Ä–æ–≤–µ—Ä–∫–∞ –Ω–µ —Å—Ä–∞–±–æ—Ç–∞–ª–∞
    debug_mode = true, -- –≤–∫–ª—é—á–∏—Ç—å —Ä–µ–∂–∏–º –æ—Ç–ª–∞–¥–∫–∏ —Å–µ—Ä–≤–µ—Ä—Ö–æ–ø–∞
    retry_delay = 5, -- –∑–∞–¥–µ—Ä–∂–∫–∞ –ø–µ—Ä–µ–¥ –ø–æ–≤—Ç–æ—Ä–Ω–æ–π –ø–æ–ø—ã—Ç–∫–æ–π —Ö–æ–ø–∞ –≤ —Å–ª—É—á–∞–µ –æ—à–∏–±–∫–∏
};

-- –ù–∞—Å—Ç—Ä–æ–π–∫–∏ –≥–ª–æ–±–∞–ª—å–Ω–æ–≥–æ –∫–µ—à–∏—Ä–æ–≤–∞–Ω–∏—è
getgenv().GlobalCacheSettings = {
    share_cache = true, -- –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –æ–±—â–∏–π –∫–µ—à –¥–ª—è –≤—Å–µ—Ö –∞–∫–∫–∞—É–Ω—Ç–æ–≤
    cache_directory = "globalriftcache", -- –ø–∞–ø–∫–∞ –¥–ª—è –æ–±—â–µ–≥–æ –∫–µ—à–∞
    check_webhook_history = true, -- –ø—Ä–æ–≤–µ—Ä—è—Ç—å –∏—Å—Ç–æ—Ä–∏—é –≤–µ–±—Ö—É–∫–æ–≤
    webhook_cooldown = 900, -- 15 –º–∏–Ω—É—Ç –≤ —Å–µ–∫—É–Ω–¥–∞—Ö (–º–∏–Ω. –∏–Ω—Ç–µ—Ä–≤–∞–ª –º–µ–∂–¥—É –ø–æ–≤—Ç–æ—Ä–Ω—ã–º–∏ –≤–µ–±—Ö—É–∫–∞–º–∏ –¥–ª—è –æ–¥–Ω–æ–≥–æ —Ç–∏–ø–∞ —Ä–∏—Ñ—Ç–∞)
};

if getgenv().Optimization.state then
    if setfpscap ~= nil then setfpscap(getgenv().Optimization.fps); end
    UserSettings().GameSettings.MasterVolume = 0;
    settings().Rendering.QualityLevel = "Level01";
    game:GetService("RunService"):Set3dRenderingEnabled(not getgenv().Optimization.hide_screen);
end

local players = game:GetService("Players");
local local_player = players.LocalPlayer;
local http_service = game:GetService("HttpService")
local teleport_service = game:GetService("TeleportService");

-- –û—Ç–ª–∞–¥–æ—á–Ω–∞—è —Ñ—É–Ω–∫—Ü–∏—è –¥–ª—è –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏—è
local function debug_log(...)
    if getgenv().ServerHopSettings.debug_mode then
        local args = {...}
        local message = "„Äê–°–µ—Ä–≤–µ—Ä—Ö–æ–ø„Äë: "
        for i, arg in ipairs(args) do
            message = message .. tostring(arg) .. " "
        end
        print(message)
    end
end

-- –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–µ: –¥–æ–±–∞–≤–ª—è—é –æ–∂–∏–¥–∞–Ω–∏–µ –∏ –ø—Ä–æ–≤–µ—Ä–∫–∏ –Ω–∞ nil
local rifts
local function getRifts()
    local rendered = workspace:FindFirstChild("Rendered")
    if rendered then
        rifts = rendered:FindFirstChild("Rifts")
    end
    return rifts ~= nil
end

-- –ü—Ä–æ–±—É–µ–º –Ω–∞–π—Ç–∏ —Ä–∏—Ñ—Ç—ã —Å –∑–∞–¥–µ—Ä–∂–∫–æ–π
repeat
    task.wait(2) -- –û–∂–∏–¥–∞–Ω–∏–µ –¥–ª—è –∑–∞–≥—Ä—É–∑–∫–∏ –Ω–µ–æ–±—Ö–æ–¥–∏–º—ã—Ö –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–æ–≤
    print("Waiting for Rifts to load...")
until getRifts()

-- –°–æ–∑–¥–∞–µ–º –ø–∞–ø–∫—É –¥–ª—è –≥–ª–æ–±–∞–ª—å–Ω–æ–≥–æ –∫—ç—à–∞ –µ—Å–ª–∏ –µ—ë –Ω–µ—Ç
if getgenv().GlobalCacheSettings.share_cache then
    if not isfolder(getgenv().GlobalCacheSettings.cache_directory) then
        makefolder(getgenv().GlobalCacheSettings.cache_directory)
        print("Created global cache directory:", getgenv().GlobalCacheSettings.cache_directory)
    end
end

-- –£–ª—É—á—à–µ–Ω–Ω–∞—è —Å–∏—Å—Ç–µ–º–∞ –∫—ç—à–∏—Ä–æ–≤–∞–Ω–∏—è —Å –ø–æ–¥–¥–µ—Ä–∂–∫–æ–π –≥–ª–æ–±–∞–ª—å–Ω–æ–≥–æ –¥–æ—Å—Ç—É–ø–∞
local function getGlobalCacheFilePath(rift_type)
    if getgenv().GlobalCacheSettings.share_cache then
        return getgenv().GlobalCacheSettings.cache_directory .. "/" .. rift_type .. "_cache.json"
    else
        return "rifts_cache_" .. rift_type .. ".json"
    end
end

-- –û—Å–Ω–æ–≤–Ω–æ–π —Ñ–∞–π–ª –∫—ç—à–∞ –¥–ª—è –æ–±—Ä–∞—Ç–Ω–æ–π —Å–æ–≤–º–µ—Å—Ç–∏–º–æ—Å—Ç–∏
local cache_file = "rifts_cache.json"
local webhook_history_file = "webhook_history.json"
local rifts_cache = {}
local webhook_history = {}

-- –§—É–Ω–∫—Ü–∏—è –¥–ª—è –±–µ–∑–æ–ø–∞—Å–Ω–æ–≥–æ —á—Ç–µ–Ω–∏—è —Ñ–∞–π–ª–∞ —Å –ø–æ–≤—Ç–æ—Ä–Ω—ã–º–∏ –ø–æ–ø—ã—Ç–∫–∞–º–∏
local function safeReadFile(filepath, max_attempts)
    max_attempts = max_attempts or 3
    local attempts = 0
    local content
    
    while attempts < max_attempts do
        attempts = attempts + 1
        local success, result = pcall(function() 
            return readfile(filepath) 
        end)
        
        if success then
            content = result
            break
        else
            if attempts < max_attempts then
                task.wait(0.2) -- –ñ–¥–µ–º –Ω–µ–±–æ–ª—å—à–æ–π –∏–Ω—Ç–µ—Ä–≤–∞–ª –ø–µ—Ä–µ–¥ –ø–æ–≤—Ç–æ—Ä–Ω–æ–π –ø–æ–ø—ã—Ç–∫–æ–π
            end
        end
    end
    
    return content
end

-- –§—É–Ω–∫—Ü–∏—è –¥–ª—è –±–µ–∑–æ–ø–∞—Å–Ω–æ–π –∑–∞–ø–∏—Å–∏ —Ñ–∞–π–ª–∞ —Å –ø–æ–≤—Ç–æ—Ä–Ω—ã–º–∏ –ø–æ–ø—ã—Ç–∫–∞–º–∏
local function safeWriteFile(filepath, content, max_attempts)
    max_attempts = max_attempts or 3
    local attempts = 0
    
    while attempts < max_attempts do
        attempts = attempts + 1
        local success = pcall(function() 
            writefile(filepath, content) 
        end)
        
        if success then
            return true
        else
            if attempts < max_attempts then
                task.wait(0.2) -- –ñ–¥–µ–º –Ω–µ–±–æ–ª—å—à–æ–π –∏–Ω—Ç–µ—Ä–≤–∞–ª –ø–µ—Ä–µ–¥ –ø–æ–≤—Ç–æ—Ä–Ω–æ–π –ø–æ–ø—ã—Ç–∫–æ–π
            end
        end
    end
    
    return false
end

-- –£–ª—É—á—à–µ–Ω–Ω–∞—è —Ñ—É–Ω–∫—Ü–∏—è –¥–ª—è –ø—Ä–æ–≤–µ—Ä–∫–∏, –±—ã–ª –ª–∏ —Ä–∏—Ñ—Ç —É–∂–µ –æ–±—Ä–∞–±–æ—Ç–∞–Ω
local function isRiftCached(rift_name, position, luck_value)
    -- –°–æ–∑–¥–∞–µ–º –±–æ–ª–µ–µ –Ω–∞–¥–µ–∂–Ω—ã–π ID, —É—á–∏—Ç—ã–≤–∞—é—â–∏–π –±–æ–ª—å—à–µ –ø–∞—Ä–∞–º–µ—Ç—Ä–æ–≤
    local precise_position = {
        x = math.floor(position.X * 10) / 10, -- –° —Ç–æ—á–Ω–æ—Å—Ç—å—é –¥–æ 0.1
        y = math.floor(position.Y * 10) / 10,
        z = math.floor(position.Z * 10) / 10
    }
    
    local rift_id = string.format("%s_%d_%d_%d_%s", 
        rift_name,
        math.floor(precise_position.x), 
        math.floor(precise_position.y), 
        math.floor(precise_position.z),
        luck_value or "noluck"
    )
    
    -- –ü—Ä–æ–≤–µ—Ä—è–µ–º –ª–æ–∫–∞–ª—å–Ω—ã–π –∫—ç—à
    if rifts_cache[rift_id] then
        return true, rift_id
    end
    
    -- –ü—Ä–æ–≤–µ—Ä—è–µ–º –≥–ª–æ–±–∞–ª—å–Ω—ã–π –∫—ç—à –¥–ª—è —ç—Ç–æ–≥–æ —Ç–∏–ø–∞ —Ä–∏—Ñ—Ç–∞
    if getgenv().GlobalCacheSettings.share_cache then
        local global_cache_path = getGlobalCacheFilePath(rift_name)
        
        if isfile(global_cache_path) then
            local content = safeReadFile(global_cache_path)
            
            if content then
                local global_cache = http_service:JSONDecode(content)
                if global_cache[rift_id] then
                    return true, rift_id
                end
            end
        end
    end
    
    -- –ü—Ä–æ–≤–µ—Ä—è–µ–º –∏—Å—Ç–æ—Ä–∏—é –≤–µ–±—Ö—É–∫–æ–≤ –¥–ª—è —ç—Ç–æ–≥–æ —Ç–∏–ø–∞ —Ä–∏—Ñ—Ç–∞
    if getgenv().GlobalCacheSettings.check_webhook_history then
        local current_time = os.time()
        
        if webhook_history[rift_name] and 
           current_time - webhook_history[rift_name] < getgenv().GlobalCacheSettings.webhook_cooldown then
            print("Webhook cooldown active for", rift_name, "- last webhook was", 
                  current_time - webhook_history[rift_name], "seconds ago")
            return true, rift_id
        end
    end
    
    return false, rift_id
end

-- –§—É–Ω–∫—Ü–∏—è –¥–ª—è —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è —Ä–∏—Ñ—Ç–∞ –≤ –∫—ç—à–µ
local function cacheRift(rift_id, rift_name)
    local current_time = os.time()
    
    -- –°–æ—Ö—Ä–∞–Ω—è–µ–º –≤ –ª–æ–∫–∞–ª—å–Ω—ã–π –∫—ç—à
    rifts_cache[rift_id] = current_time
    
    -- –°–æ—Ö—Ä–∞–Ω—è–µ–º –≤ –≥–ª–æ–±–∞–ª—å–Ω—ã–π –∫—ç—à –¥–ª—è —ç—Ç–æ–≥–æ —Ç–∏–ø–∞ —Ä–∏—Ñ—Ç–∞
    if getgenv().GlobalCacheSettings.share_cache then
        local global_cache_path = getGlobalCacheFilePath(rift_name)
        local global_cache = {}
        
        -- –ü—ã—Ç–∞–µ–º—Å—è –∑–∞–≥—Ä—É–∑–∏—Ç—å —Å—É—â–µ—Å—Ç–≤—É—é—â–∏–π –∫—ç—à
        if isfile(global_cache_path) then
            local content = safeReadFile(global_cache_path)
            if content then
                pcall(function()
                    global_cache = http_service:JSONDecode(content)
                end)
            end
        end
        
        -- –û–±–Ω–æ–≤–ª—è–µ–º –∫—ç—à
        global_cache[rift_id] = current_time
        
        -- –û—á–∏—â–∞–µ–º —É—Å—Ç–∞—Ä–µ–≤—à–∏–µ –∑–∞–ø–∏—Å–∏
        local new_cache = {}
        for id, timestamp in pairs(global_cache) do
            if current_time - timestamp < 900 then -- 15 –º–∏–Ω—É—Ç
                new_cache[id] = timestamp
            end
        end
        
        -- –°–æ—Ö—Ä–∞–Ω—è–µ–º –æ–±–Ω–æ–≤–ª–µ–Ω–Ω—ã–π –∫—ç—à
        safeWriteFile(global_cache_path, http_service:JSONEncode(new_cache))
    end
    
    -- –°–æ—Ö—Ä–∞–Ω—è–µ–º –≤ –∏—Å—Ç–æ—Ä–∏–∏ –≤–µ–±—Ö—É–∫–æ–≤
    if getgenv().GlobalCacheSettings.check_webhook_history then
        webhook_history[rift_name] = current_time
        
        -- –°–æ—Ö—Ä–∞–Ω—è–µ–º –∏—Å—Ç–æ—Ä–∏—é –≤–µ–±—Ö—É–∫–æ–≤
        safeWriteFile(webhook_history_file, http_service:JSONEncode(webhook_history))
    end
    
    -- –î–ª—è –æ–±—Ä–∞—Ç–Ω–æ–π —Å–æ–≤–º–µ—Å—Ç–∏–º–æ—Å—Ç–∏ —Å–æ—Ö—Ä–∞–Ω—è–µ–º –≤ –æ—Å–Ω–æ–≤–Ω–æ–π –∫—ç—à
    pcall(function()
        safeWriteFile(cache_file, http_service:JSONEncode(rifts_cache))
    end)
end

-- –§—É–Ω–∫—Ü–∏—è –¥–ª—è –æ—á–∏—Å—Ç–∫–∏ –∫—ç—à–∞
local function cleanCache()
    local current_time = os.time()
    local new_cache = {}
    local removed_count = 0
    
    for rift_id, timestamp in pairs(rifts_cache) do
        if current_time - timestamp < 900 then -- 15 –º–∏–Ω—É—Ç
            new_cache[rift_id] = timestamp
        else
            removed_count = removed_count + 1
        end
    end
    
    rifts_cache = new_cache
    
    -- –°–æ—Ö—Ä–∞–Ω—è–µ–º –æ–±–Ω–æ–≤–ª–µ–Ω–Ω—ã–π –∫—ç—à
    pcall(function()
        safeWriteFile(cache_file, http_service:JSONEncode(rifts_cache))
    end)
    
    -- –¢–∞–∫–∂–µ –æ—á–∏—â–∞–µ–º –≥–ª–æ–±–∞–ª—å–Ω—ã–µ –∫—ç—à–∏
    if getgenv().GlobalCacheSettings.share_cache then
        if isfolder(getgenv().GlobalCacheSettings.cache_directory) then
            local files = listfiles(getgenv().GlobalCacheSettings.cache_directory)
            for _, file_path in ipairs(files) do
                -- –¢–æ–ª—å–∫–æ –µ—Å–ª–∏ —ç—Ç–æ JSON-—Ñ–∞–π–ª –∫—ç—à–∞
                if string.match(file_path, "cache%.json$") then
                    local content = safeReadFile(file_path)
                    if content then
                        local global_cache = http_service:JSONDecode(content)
                        local new_global_cache = {}
                        
                        for id, timestamp in pairs(global_cache) do
                            if current_time - timestamp < 900 then -- 15 –º–∏–Ω—É—Ç
                                new_global_cache[id] = timestamp
                            end
                        end
                        
                        safeWriteFile(file_path, http_service:JSONEncode(new_global_cache))
                    end
                end
            end
        end
    end
    
    local cache_size = 0
    for _ in pairs(new_cache) do cache_size = cache_size + 1 end
    print("Cache cleaned: Removed", removed_count, "items. Current cache size:", cache_size)
end

-- –ó–∞–≥—Ä—É–∂–∞–µ–º –∫—ç—à, –µ—Å–ª–∏ –æ–Ω —Å—É—â–µ—Å—Ç–≤—É–µ—Ç
if pcall(function() readfile(cache_file) end) then
    pcall(function()
        rifts_cache = http_service:JSONDecode(readfile(cache_file))
    end)
    cleanCache() -- –û—á–∏—â–∞–µ–º –∫—ç—à –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ
end

-- –ó–∞–≥—Ä—É–∂–∞–µ–º –∏—Å—Ç–æ—Ä–∏—é –≤–µ–±—Ö—É–∫–æ–≤, –µ—Å–ª–∏ –æ–Ω–∞ —Å—É—â–µ—Å—Ç–≤—É–µ—Ç
if pcall(function() readfile(webhook_history_file) end) then
    pcall(function()
        webhook_history = http_service:JSONDecode(readfile(webhook_history_file))
    end)
end

-- –ó–∞–ø—É—Å–∫–∞–µ–º –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫—É—é –æ—á–∏—Å—Ç–∫—É –∫—ç—à–∞ –∫–∞–∂–¥—ã–µ 5 –º–∏–Ω—É—Ç
task.spawn(function()
    while true do
        task.wait(300) -- 5 –º–∏–Ω—É—Ç
        print("Scheduled cache cleanup...")
        cleanCache()
    end
end)

local whitelisted_eggs = { -- —Ç–µ–ø–µ—Ä—å —Ç—É—Ç –º–µ–Ω—è–µ—à—å –≤–µ–±—Ö—É–∫–∏ –ù–ê –ö–ê–ñ–î–û–ï –Ø–ô–¶–û/–°–£–ù–î–£–ö, –≤ luck —á–µ—Ä–µ–∑ –∑–∞–ø—è—Ç—É—é –≤ –∫–∞–≤—ã—á–∫–∞—Ö –ø—Ä–æ–ø–∏—Å—ã–≤–∞–µ—à—å –º–Ω–æ–∂–∏—Ç–µ–ª—å —É–¥–∞—á–∏
    ["rainbow-egg"] = {
        webhook = "https://discord.com/api/webhooks/1369680016367161465/ytWtBI3H3EKVrjifey0KMsJ05wEtuy1cdMV7EvJ5OX6cb128k36s17sS8EYM7pCXkxkg",
        role_id = "", -- ID —Ä–æ–ª–∏ –∫–∞–∫ —Å—Ç—Ä–æ–∫–∞
        luck = { "x25" },
        name = "Rainbow Egg"
    },
    ["nightmare-egg"] = {
        webhook = "https://discord.com/api/webhooks/1369679913308655828/es2UQtG9m_FY_aYotNaVKpFNwDXj0IOakFJg3g8lQ107fAHPJWoUqvU_1_RLEpCGUmIJ",
        role_id = "",
        luck = { "x25" },
        name = "Nightmare Egg"
    },
    ["void-egg"] = {
        webhook = "https://discord.com/api/webhooks/1369680094322364446/vkkzcYcVY30Tb-D2MRZMrQbR3d2U_0YCdevjgPR2QTaEjFcFs8b7uZbEi-C5u60Bum6N",
        role_id = "",
        luck = { "x25" },
        name = "Void Egg"
    },
    ["royal-chest"] = {
        webhook = "https://discord.com/api/webhooks/1369320116969541702/217cjweQ3Aga1IwwBzClwuNpe2KoXRKOq2IJMCV9sgzlEpd9iYHH2UJ89IT4qq8smumE",
        role_id = "1371539682713796648",
        name = "Royal Chest"
    },
    ["bubble-rift"] = {
        webhook = "https://discord.com/api/webhooks/1369680404487077958/pNTDbV_qBHqzTKXrxagTlqMyFgc13qmtRha8ca1Fkn9AdlnFgjT977lDU9A8Tavw1Ju9",
        role_id = "",
        name = "Bubble Rifft"
    },
    ["mining-egg"] = {
        webhook = "https://discord.com/api/webhooks/1369680163113140354/KSzLYRiJMmYeeGOv4aSekxlVxrxihddZrvyJ_AfAtwDZsLCCYwXMvYq7HrEfP1N6tJjH",
        role_id = "",
        luck = { "x25" },
        name = "Mining Egg"
    },
    ["cyber-egg"] = {
        webhook = "https://discord.com/api/webhooks/1369680252145504256/OEFlHbKAzOuz6kZ97gcgsNyDrBR6wMBNlwiaIXWVNTeXUM5yIDLPGstTawfPE4Lx6a6R",
        role_id = "1371540351361482802",
        luck = { "x25" },
        name = "Cyber Egg"
    },
    ["dice-chest"] = {
        webhook = "https://discord.com/api/webhooks/1369680321729138718/s6R5cyeB3k9sBAD4Akxaem86xzxW4-6lNWgs-V5P2TDH86pxWl7mT1Wwvs-XfN4O-GVS",
        role_id = "1371539732022169601",
        name = "Dice Chest"
    },
    ["underworld-1"] = {
        webhook = "https://discord.com/api/webhooks/1371074619645235243/u_0v1rptBiojPUlQSSwaA7zoIbryx-4qEK1JZaaJkKd82T9Mo4VWMN3hyD6beszMNcYY",
        role_id = "1371510979116007545",
        luck = { "x25" },
        name = "Underworld 1"
    },
    ["underworld-2"] = {
        webhook = "https://discord.com/api/webhooks/1371074619645235243/u_0v1rptBiojPUlQSSwaA7zoIbryx-4qEK1JZaaJkKd82T9Mo4VWMN3hyD6beszMNcYY",
        role_id = "1371510979116007545",
        luck = { "x25" },
        name = "Underworld 2"
    },
    ["underworld-3"] = {
        webhook = "https://discord.com/api/webhooks/1371074619645235243/u_0v1rptBiojPUlQSSwaA7zoIbryx-4qEK1JZaaJkKd82T9Mo4VWMN3hyD6beszMNcYY",
        role_id = "1371510979116007545",
        luck = { "x25" },
        name = "Underworld 3"
    }
};
local spam_messages = {
    "Best Rift Finder = ƒ£ƒ£/ easyrift üî•",
    "Silly Egg is found! ƒ£ƒ£/ easyrift üî•",
    "Best Pet Shop = ƒ£ƒ£/ easyrift üî•",
    "REACH THE LEADERBOARDS USING ƒüƒü/ easyrift üèÜ",
    "SECRETS GIVE-AWAY HAPPENING ƒ£ƒ£/ easyrift üåü",
    "X25 LUCK RIFTS AT ƒ£ƒ£/ easyrift üçÄ",
    "GET SILLY EGG AT ƒ£ƒ£/ easyrift ü•ö",
    "UNDERWORLD RIFT ƒ£ƒ£/ easyrift ü•ö"
};

local join_link = string.format('https://www.roblox.com/games/start?placeId=16302670534&launchData=%d/%s', game.PlaceId, game.JobId);

local parse_time = function(text)
    text = string.lower(string.gsub(text, "^%s*(.-)%s*$", "%1"));
    local number, unit = string.match(text, "(%d+)%s*(%a+)");
    if number == nil or unit == nil then 
        return 0;
    end
    
    number = tonumber(number);
    
    if string.find(unit, "second") then
        return number;
    elseif string.find(unit, "minute") then
        return number * 60;
    elseif string.find(unit, "hour") then
        return number * 3600;
    else
        return 0;
    end
end

local time_to_discorddate = function(time_)
    return string.format("<t:%d:R>", time_);
end

local request = (syn ~= nil and syn.request) or (http ~= nil and http.request) or (fluxus ~= nil and fluxus.request) or http_request or request;
-- –£–ª—É—á—à–µ–Ω–Ω–∞—è —Ñ—É–Ω–∫—Ü–∏—è notify –¥–ª—è –æ—Ç–ª–∞–¥–∫–∏ –ø–∏–Ω–≥–æ–≤
local notify = function(webhook, data, rift_name)
    local response = request({
        Url = webhook, 
        Body = http_service:JSONEncode(data), 
        Method = "POST", 
        Headers = { ['content-type'] = "application/json" }
    });
    print("Discord webhook sent for", rift_name, "- Response:", response.StatusCode, response.StatusMessage);
    return response;
end

-- –ü–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –¥–ª—è –æ—Ç—Å–ª–µ–∂–∏–≤–∞–Ω–∏—è —Å—Ç–∞—Ç—É—Å–∞ —Å–µ—Ä–≤–µ—Ä—Ö–æ–ø–∞
local is_server_hopping = false
local last_hop_attempt = 0
local server_hop_failures = 0

-- –£–ª—É—á—à–µ–Ω–Ω–∞—è —Ñ—É–Ω–∫—Ü–∏—è –≤—ã–±–æ—Ä–∞ —Å–µ—Ä–≤–µ—Ä–∞
local function findNewServer()
    debug_log("–ü–æ–∏—Å–∫ –Ω–æ–≤–æ–≥–æ —Å–µ—Ä–≤–µ—Ä–∞...")
    local file = "serverhop_history.json";
    local history = {};
    local current_time = os.time();
    
    -- –ì–µ–Ω–µ—Ä–∏—Ä—É–µ–º —É–Ω–∏–∫–∞–ª—å–Ω—ã–π seed –¥–ª—è —Ä–∞–Ω–¥–æ–º–∏–∑–∞—Ü–∏–∏ –Ω–∞ –æ—Å–Ω–æ–≤–µ –∏–º–µ–Ω–∏ –∏–≥—Ä–æ–∫–∞ –∏ –≤—Ä–µ–º–µ–Ω–∏
    local player_seed = 0
    for i = 1, #local_player.Name do
        player_seed = player_seed + string.byte(local_player.Name, i)
    end
    math.randomseed(player_seed + os.time() % 1000)
    
    -- Load history if file exists
    if pcall(function() readfile(file) end) then
        local success, result = pcall(function() return http_service:JSONDecode(readfile(file)) end)
        if success and result then
            history = result
            
            local new_history = {};
            for serverId, jt in pairs(history) do
                if current_time - jt < 540 then
                    new_history[serverId] = jt;
                end
            end

            history = new_history;
        else
            debug_log("–û—à–∏–±–∫–∞ –ø—Ä–∏ —á—Ç–µ–Ω–∏–∏ –∏—Å—Ç–æ—Ä–∏–∏ —Å–µ—Ä–≤–µ—Ä–æ–≤:", result)
        end
    end
    
    -- –î–æ–±–∞–≤–ª—è–µ–º –∂–µ—Ä–µ–±—å–µ–≤–∫—É –¥–ª—è –±–æ–ª–µ–µ —Å–ª—É—á–∞–π–Ω–æ–≥–æ —Ä–∞—Å–ø—Ä–µ–¥–µ–ª–µ–Ω–∏—è —Å–µ—Ä–≤–µ—Ä–æ–≤
    local page_size = 100
    local page_offset = math.random(0, 5) * page_size
    local sort_order = (math.random(1, 2) == 1) and "Asc" or "Desc"
    
    debug_log("–ó–∞–ø—Ä–∞—à–∏–≤–∞–µ–º —Å–ø–∏—Å–æ–∫ —Å–µ—Ä–≤–µ—Ä–æ–≤...")
    local req = request({
        Url = string.format("https://games.roblox.com/v1/games/%d/servers/Public?sortOrder=%s&limit=%d&cursor=%s&excludeFullGames=true", 
            game.PlaceId,
            sort_order,
            page_size,
            page_offset > 0 and tostring(page_offset) or ""
        );
    })
    
    local success, body = pcall(function()
        return http_service:JSONDecode(req.Body);
    end)
    
    if success and body and body.data then
        debug_log("–ü–æ–ª—É—á–µ–Ω —Å–ø–∏—Å–æ–∫ –∏–∑", #body.data, "—Å–µ—Ä–≤–µ—Ä–æ–≤")
        local servers = {};
        local suitable_servers = 0
        
        for _, server in pairs(body.data) do
            if server.playing >= getgenv().ServerHopSettings.min_players and 
               server.playing <= getgenv().ServerHopSettings.max_players and
               server.id ~= game.JobId and 
               not history[server.id] then
                
                suitable_servers = suitable_servers + 1
                -- –ò—Å–ø–æ–ª—å–∑—É–µ–º —Ä–∞–∑–Ω—ã–µ —Å—Ç—Ä–∞—Ç–µ–≥–∏–∏ –¥–ª—è —Ä–∞–∑–Ω—ã—Ö –∞–∫–∫–∞—É–Ω—Ç–æ–≤ –Ω–∞ –æ—Å–Ω–æ–≤–µ –∏—Ö seed
                local priority
                if player_seed % 3 == 0 then
                    -- –ü—Ä–µ–¥–ø–æ—á–∏—Ç–∞–µ–º —Å–µ—Ä–≤–µ—Ä—ã —Å –º–µ–Ω—å—à–∏–º —á–∏—Å–ª–æ–º –∏–≥—Ä–æ–∫–æ–≤
                    priority = 50 - server.playing
                elseif player_seed % 3 == 1 then 
                    -- –ü—Ä–µ–¥–ø–æ—á–∏—Ç–∞–µ–º —Å–µ—Ä–≤–µ—Ä—ã —Å –±–æ–ª—å—à–∏–º —á–∏—Å–ª–æ–º –∏–≥—Ä–æ–∫–æ–≤
                    priority = math.min(server.playing, 30)
                else
                    -- –†–∞–≤–Ω–æ–º–µ—Ä–Ω–æ–µ —Ä–∞—Å–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ
                    priority = math.random(10, 20)
                end
                
                for i = 1, priority do
                    table.insert(servers, server);
                end
            end
        end
        
        debug_log("–ù–∞–π–¥–µ–Ω–æ –ø–æ–¥—Ö–æ–¥—è—â–∏—Ö —Å–µ—Ä–≤–µ—Ä–æ–≤:", suitable_servers)
        
        -- –ü–µ—Ä–µ–º–µ—à–∏–≤–∞–µ–º —Å–µ—Ä–≤–µ—Ä—ã –¥–ª—è –ª—É—á—à–µ–π —Ä–∞–Ω–¥–æ–º–∏–∑–∞—Ü–∏–∏
        for i = #servers, 2, -1 do
            local j = math.random(1, i)
            servers[i], servers[j] = servers[j], servers[i]
        end
        
        if #servers > 0 then
            local selected_server = servers[math.random(1, #servers)];
            history[selected_server.id] = current_time;
            writefile(file, http_service:JSONEncode(history));
            
            debug_log("–í—ã–±—Ä–∞–Ω —Å–µ—Ä–≤–µ—Ä —Å", selected_server.playing, "–∏–≥—Ä–æ–∫–∞–º–∏, ID:", selected_server.id)
            return selected_server
        else
            debug_log("–ù–µ—Ç –ø–æ–¥—Ö–æ–¥—è—â–∏—Ö —Å–µ—Ä–≤–µ—Ä–æ–≤")
            return nil
        end
    else
        debug_log("–û—à–∏–±–∫–∞ –ø—Ä–∏ –∑–∞–ø—Ä–æ—Å–µ —Å–ø–∏—Å–∫–∞ —Å–µ—Ä–≤–µ—Ä–æ–≤")
        return nil
    end
end

-- –£–ª—É—á—à–µ–Ω–Ω—ã–π —Å–µ—Ä–≤–µ—Ä-—Ö–æ–ø –¥–ª—è –ø—Ä–µ–¥–æ—Ç–≤—Ä–∞—â–µ–Ω–∏—è –ø–æ–ø–∞–¥–∞–Ω–∏—è –Ω–∞ –æ–¥–Ω–∏ –∏ —Ç–µ –∂–µ —Å–µ—Ä–≤–µ—Ä—ã
local function serverhop()
    -- –ü—Ä–æ–≤–µ—Ä—è–µ–º, –Ω–µ –≤—ã–ø–æ–ª–Ω—è–µ—Ç—Å—è –ª–∏ —É–∂–µ —Å–µ—Ä–≤–µ—Ä—Ö–æ–ø
    if is_server_hopping then
        debug_log("–°–µ—Ä–≤–µ—Ä—Ö–æ–ø —É–∂–µ –≤—ã–ø–æ–ª–Ω—è–µ—Ç—Å—è, –ø—Ä–æ–ø—É—Å–∫–∞–µ–º...")
        return false
    end
    
    -- –ü—Ä–æ–≤–µ—Ä—è–µ–º, –Ω–µ —Å–ª–∏—à–∫–æ–º –ª–∏ —á–∞—Å—Ç–æ –ø—ã—Ç–∞–µ–º—Å—è –¥–µ–ª–∞—Ç—å —Å–µ—Ä–≤–µ—Ä—Ö–æ–ø
    local current_time = os.time()
    if current_time - last_hop_attempt < 3 then
        debug_log("–°–ª–∏—à–∫–æ–º —á–∞—Å—Ç—ã–µ –ø–æ–ø—ã—Ç–∫–∏ —Å–µ—Ä–≤–µ—Ä—Ö–æ–ø–∞, –ø—Ä–æ–ø—É—Å–∫–∞–µ–º...")
        return false
    end
    
    -- –û—Ç–º–µ—á–∞–µ–º, —á—Ç–æ —Å–µ—Ä–≤–µ—Ä—Ö–æ–ø –Ω–∞—á–∞–ª—Å—è
    is_server_hopping = true
    last_hop_attempt = current_time
    debug_log("–ù–∞—á–∏–Ω–∞–µ–º —Å–µ—Ä–≤–µ—Ä—Ö–æ–ø")
    
    -- –î–æ–±–∞–≤–ª—è–µ–º —Å–ª—É—á–∞–π–Ω—É—é –∑–∞–¥–µ—Ä–∂–∫—É –¥–ª—è —Ä–∞—Å—Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏–∏ –∞–∫–∫–∞—É–Ω—Ç–æ–≤ (—É–º–µ–Ω—å—à–µ–Ω–∞ –¥–ª—è –±–æ–ª–µ–µ –±—ã—Å—Ç—Ä–æ–≥–æ —Å–µ—Ä–≤–µ—Ä—Ö–æ–ø–∞)
    if getgenv().ServerHopSettings.use_random_offset then
        local random_delay = math.random(1, 3) -- –£–º–µ–Ω—å—à–µ–Ω–æ –¥–æ 1-3 —Å–µ–∫—É–Ω–¥
        debug_log("–î–æ–±–∞–≤–ª—è–µ–º —Å–ª—É—á–∞–π–Ω—É—é –∑–∞–¥–µ—Ä–∂–∫—É:", random_delay, "—Å–µ–∫—É–Ω–¥")
        wait(random_delay)
    end
    
    -- –û–±–Ω–æ–≤–ª—è–µ–º –≤—Ä–µ–º—è –ø–æ—Å–ª–µ–¥–Ω–µ–≥–æ —Å–µ—Ä–≤–µ—Ä—Ö–æ–ø–∞
    getgenv().ServerHopSettings.last_hop_time = current_time
    debug_log("–°–µ—Ä–≤–µ—Ä—Ö–æ–ø –∏–Ω–∏—Ü–∏–∏—Ä–æ–≤–∞–Ω –≤:", os.date("%H:%M:%S", current_time))

    -- –ù–∞—Ö–æ–¥–∏–º –ø–æ–¥—Ö–æ–¥—è—â–∏–π —Å–µ—Ä–≤–µ—Ä
    local selected_server = findNewServer()
    
    -- –ü—Ä–æ–±—É–µ–º —Ç–µ–ª–µ–ø–æ—Ä—Ç–∏—Ä–æ–≤–∞—Ç—å—Å—è
    if selected_server then
        debug_log("–í—ã–ø–æ–ª–Ω—è–µ–º —Ç–µ–ª–µ–ø–æ—Ä—Ç–∞—Ü–∏—é...")
        
        local success = pcall(function()
            teleport_service:TeleportToPlaceInstance(game.PlaceId, selected_server.id, local_player)
        end)
        
        if success then
            debug_log("–ö–æ–º–∞–Ω–¥–∞ —Ç–µ–ª–µ–ø–æ—Ä—Ç–∞—Ü–∏–∏ –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω–∞ —É—Å–ø–µ—à–Ω–æ")
            -- –î–∞–µ–º 10 —Å–µ–∫—É–Ω–¥ –Ω–∞ —Ç–µ–ª–µ–ø–æ—Ä—Ç–∞—Ü–∏—é
            task.delay(10, function()
                debug_log("–ü—Ä–æ–≤–µ—Ä—è–µ–º, —Å–æ—Å—Ç–æ—è–ª–∞—Å—å –ª–∏ —Ç–µ–ª–µ–ø–æ—Ä—Ç–∞—Ü–∏—è...")
                if local_player and local_player.Parent then
                    debug_log("–¢–µ–ª–µ–ø–æ—Ä—Ç–∞—Ü–∏—è –Ω–µ —É–¥–∞–ª–∞—Å—å –∏–ª–∏ –∑–∞–Ω—è–ª–∞ —Å–ª–∏—à–∫–æ–º –º–Ω–æ–≥–æ –≤—Ä–µ–º–µ–Ω–∏, —Å–±—Ä–∞—Å—ã–≤–∞–µ–º —Ñ–ª–∞–≥ —Å–µ—Ä–≤–µ—Ä—Ö–æ–ø–∞")
                    is_server_hopping = false
                    server_hop_failures = server_hop_failures + 1
                    
                    -- –ï—Å–ª–∏ –±—ã–ª–æ –º–Ω–æ–≥–æ –Ω–µ—É–¥–∞—á–Ω—ã—Ö –ø–æ–ø—ã—Ç–æ–∫, –ø—Ä–æ–±—É–µ–º –∞–ª—å—Ç–µ—Ä–Ω–∞—Ç–∏–≤–Ω—ã–π –º–µ—Ç–æ–¥
                    if server_hop_failures >= 3 then
                        debug_log("–°–ª–∏—à–∫–æ–º –º–Ω–æ–≥–æ –Ω–µ—É–¥–∞—á–Ω—ã—Ö –ø–æ–ø—ã—Ç–æ–∫, –ø—Ä–æ–±—É–µ–º –∞–ª—å—Ç–µ—Ä–Ω–∞—Ç–∏–≤–Ω—ã–π –º–µ—Ç–æ–¥")
                        teleport_service:Teleport(game.PlaceId, local_player)
                    end
                end
            end)
            return true
        else
            debug_log("–û—à–∏–±–∫–∞ –ø—Ä–∏ –æ—Ç–ø—Ä–∞–≤–∫–µ –∫–æ–º–∞–Ω–¥—ã —Ç–µ–ª–µ–ø–æ—Ä—Ç–∞—Ü–∏–∏")
            is_server_hopping = false
            server_hop_failures = server_hop_failures + 1
            return false
        end
    else
        debug_log("–ù–µ —É–¥–∞–ª–æ—Å—å –Ω–∞–π—Ç–∏ –ø–æ–¥—Ö–æ–¥—è—â–∏–π —Å–µ—Ä–≤–µ—Ä, –ø—Ä–æ–±—É–µ–º –æ–±—â—É—é —Ç–µ–ª–µ–ø–æ—Ä—Ç–∞—Ü–∏—é")
        
        local success = pcall(function()
            teleport_service:Teleport(game.PlaceId, local_player)
        end)
        
        if success then
            debug_log("–û–±—â–∞—è —Ç–µ–ª–µ–ø–æ—Ä—Ç–∞—Ü–∏—è –∏–Ω–∏—Ü–∏–∏—Ä–æ–≤–∞–Ω–∞")
            -- –ê–Ω–∞–ª–æ–≥–∏—á–Ω–æ –¥–∞–µ–º 10 —Å–µ–∫—É–Ω–¥
            task.delay(10, function()
                if local_player and local_player.Parent then
                    is_server_hopping = false
                end
            end)
            return true
        else
            debug_log("–û—à–∏–±–∫–∞ –ø—Ä–∏ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏–∏ –æ–±—â–µ–π —Ç–µ–ª–µ–ø–æ—Ä—Ç–∞—Ü–∏–∏")
            is_server_hopping = false
            return false
        end
    end
end

-- –§—É–Ω–∫—Ü–∏—è –±–µ–∑–æ–ø–∞—Å–Ω–æ–≥–æ —Å–µ—Ä–≤–µ—Ä—Ö–æ–ø–∞ —Å –ø–æ–≤—Ç–æ—Ä–Ω—ã–º–∏ –ø–æ–ø—ã—Ç–∫–∞–º–∏
local function safeServerhop()
    local success = serverhop()
    
    if not success and getgenv().ServerHopSettings.retry_delay > 0 then
        debug_log("–°–µ—Ä–≤–µ—Ä—Ö–æ–ø –Ω–µ —É–¥–∞–ª—Å—è, –ø—Ä–æ–±—É–µ–º —Å–Ω–æ–≤–∞ —á–µ—Ä–µ–∑", getgenv().ServerHopSettings.retry_delay, "—Å–µ–∫—É–Ω–¥")
        task.delay(getgenv().ServerHopSettings.retry_delay, function()
            serverhop()
        end)
    end
end

task.spawn(function() -- anti afk
    for _,v in pairs(getconnections(local_player.Idled)) do v:Disable() end
    for _,v in pairs(getconnections(game:GetService("UserInputService").WindowFocused)) do v:Disable() end
    for _,v in pairs(getconnections(game:GetService("UserInputService").WindowFocusReleased)) do v:Disable() end
end)

task.spawn(function()
    local channel = game:GetService("TextChatService"):WaitForChild("TextChannels"):WaitForChild("RBXGeneral");
    local time = 1;
    while task.wait() do
        channel:SendAsync(spam_messages[Random.new(tick()):NextInteger(1, #spam_messages)]);
        time += 2;
        if time > 6 then
            time = 1;
        end

        task.wait(time);
    end
end)

-- –°–µ—Ä–≤–µ—Ä—Ö–æ–ø —Å —Ç–∞–π–º–µ—Ä–æ–º (–æ—Å–Ω–æ–≤–Ω–æ–π –º–µ—Ö–∞–Ω–∏–∑–º)
task.spawn(function()
    debug_log("–ó–∞–ø—É—Å–∫ —Ç–∞–π–º–µ—Ä–∞ —Å–µ—Ä–≤–µ—Ä—Ö–æ–ø–∞")
    -- –î–æ–±–∞–≤–ª—è–µ–º –Ω–µ–±–æ–ª—å—à—É—é –Ω–∞—á–∞–ª—å–Ω—É—é –∑–∞–¥–µ—Ä–∂–∫—É
    task.wait(3)
    
    while true do
        task.wait(1) -- –ü—Ä–æ–≤–µ—Ä—è–µ–º –∫–∞–∂–¥—É—é —Å–µ–∫—É–Ω–¥—É –¥–ª—è –±–æ–ª–µ–µ —Ç–æ—á–Ω–æ–≥–æ —Å—Ä–∞–±–∞—Ç—ã–≤–∞–Ω–∏—è
        
        -- –ü—Ä–æ–ø—É—Å–∫–∞–µ–º –ø—Ä–æ–≤–µ—Ä–∫–∏, –µ—Å–ª–∏ —É–∂–µ –∏–¥–µ—Ç –ø—Ä–æ—Ü–µ—Å—Å —Å–µ—Ä–≤–µ—Ä—Ö–æ–ø–∞
        if is_server_hopping then
            debug_log("–°–µ—Ä–≤–µ—Ä—Ö–æ–ø —É–∂–µ –≤—ã–ø–æ–ª–Ω—è–µ—Ç—Å—è, —Ç–∞–π–º–µ—Ä –ø—Ä–æ–ø—É—Å–∫–∞–µ—Ç –∏—Ç–µ—Ä–∞—Ü–∏—é")
            continue
        end
        
        local current_time = os.time()
        local elapsed_time = current_time - getgenv().ServerHopSettings.last_hop_time
        
        debug_log("–ü—Ä–æ–≤–µ—Ä–∫–∞ —Ç–∞–π–º–µ—Ä–∞ —Å–µ—Ä–≤–µ—Ä—Ö–æ–ø–∞ - –ø—Ä–æ—à–ª–æ", elapsed_time, "—Å–µ–∫. –∏–∑", getgenv().ServerHopSettings.interval)
        
        if elapsed_time >= getgenv().ServerHopSettings.interval then
            debug_log("–í—Ä–µ–º—è —Å–µ—Ä–≤–µ—Ä—Ö–æ–ø–∞ –Ω–∞—Å—Ç—É–ø–∏–ª–æ! –ü—Ä–æ—à–ª–æ", elapsed_time, "—Å–µ–∫—É–Ω–¥")
            safeServerhop()
        end
    end
end)

-- –ü—Ä–∏–Ω—É–¥–∏—Ç–µ–ª—å–Ω—ã–π —Å–µ—Ä–≤–µ—Ä—Ö–æ–ø –∫–∞–∂–¥—ã–µ 30 —Å–µ–∫—É–Ω–¥, –µ—Å–ª–∏ –æ—Å–Ω–æ–≤–Ω–æ–π –º–µ—Ö–∞–Ω–∏–∑–º –Ω–µ —Å—Ä–∞–±–æ—Ç–∞–ª
if getgenv().ServerHopSettings.force_hop then
    task.spawn(function()
        debug_log("–ó–∞–ø—É—Å–∫ –ø—Ä–∏–Ω—É–¥–∏—Ç–µ–ª—å–Ω–æ–≥–æ —Ç–∞–π–º–µ—Ä–∞ —Å–µ—Ä–≤–µ—Ä—Ö–æ–ø–∞")
        -- –ó–∞–ø—É—Å–∫–∞–µ–º —Å –Ω–µ–∫–æ—Ç–æ—Ä–æ–π –∑–∞–¥–µ—Ä–∂–∫–æ–π –ø–æ—Å–ª–µ –æ—Å–Ω–æ–≤–Ω–æ–≥–æ —Ç–∞–π–º–µ—Ä–∞
        task.wait(30)
        
        while true do
            -- –î–æ–ª–≥–∞—è –ø–∞—É–∑–∞, —Ç–∞–∫ –∫–∞–∫ —ç—Ç–æ —Ä–µ–∑–µ—Ä–≤–Ω—ã–π –º–µ—Ö–∞–Ω–∏–∑–º
            task.wait(30)
            
            -- –ï—Å–ª–∏ —Ö–æ–ø –Ω–µ –≤—ã–ø–æ–ª–Ω—è–ª—Å—è –¥–æ–ª–≥–æ–µ –≤—Ä–µ–º—è, –¥–µ–ª–∞–µ–º –µ–≥–æ –ø—Ä–∏–Ω—É–¥–∏—Ç–µ–ª—å–Ω–æ
            local current_time = os.time()
            local elapsed_time = current_time - getgenv().ServerHopSettings.last_hop_time
            
            debug_log("–ü—Ä–æ–≤–µ—Ä–∫–∞ –ø—Ä–∏–Ω—É–¥–∏—Ç–µ–ª—å–Ω–æ–≥–æ —Å–µ—Ä–≤–µ—Ä—Ö–æ–ø–∞ - –ø—Ä–æ—à–ª–æ", elapsed_time, "—Å–µ–∫.")
            
            if elapsed_time >= 45 then -- –ï—Å–ª–∏ –ø—Ä–æ—à–ª–æ –±–æ–ª–µ–µ 45 —Å–µ–∫—É–Ω–¥ –±–µ–∑ —Ö–æ–ø–∞
                debug_log("–ü–†–ò–ù–£–î–ò–¢–ï–õ–¨–ù–´–ô –°–ï–†–í–ï–†–•–û–ü! –ü—Ä–æ—à–ª–æ", elapsed_time, "—Å–µ–∫—É–Ω–¥ –±–µ–∑ —Ö–æ–ø–∞")
                safeServerhop()
            end
        end
    end)
end

do
    local rifts_found = 0 -- —Å—á–µ—Ç—á–∏–∫ –Ω–∞–π–¥–µ–Ω–Ω—ã—Ö —Ä–∏—Ñ—Ç–æ–≤
    local rifts_sent = 0  -- —Å—á–µ—Ç—á–∏–∫ –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω–Ω—ã—Ö –≤–µ–±—Ö—É–∫–æ–≤
    
    for _, rift in pairs(rifts:GetChildren()) do
        if not rift:IsA("Model") or not whitelisted_eggs[rift.Name] then
            continue;
        end
        
        rifts_found = rifts_found + 1
        
        local data = whitelisted_eggs[rift.Name];
        local luck = "None";
        local gui
        
        -- –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–µ: –¥–æ–±–∞–≤–ª–µ–Ω–∏–µ –ø—Ä–æ–≤–µ—Ä–æ–∫ –Ω–∞ nil –∏ –æ–∂–∏–¥–∞–Ω–∏—è –∑–∞–≥—Ä—É–∑–∫–∏
        local display = rift:FindFirstChild("Display")
        if display then
            gui = display:FindFirstChildOfClass("SurfaceGui")
            if data.luck ~= nil then
                if gui == nil then
                    repeat 
                        task.wait(0.5)
                        gui = display:FindFirstChildOfClass("SurfaceGui")
                    until gui ~= nil or task.wait(5) -- —Ç–∞–π–º–∞—É—Ç 5 —Å–µ–∫—É–Ω–¥ –Ω–∞ —Å–ª—É—á–∞–π, –µ—Å–ª–∏ GUI –Ω–µ –∑–∞–≥—Ä—É–∑–∏—Ç—Å—è
                end
                
                if gui and gui:FindFirstChild("Icon") and gui.Icon:FindFirstChild("Luck") then
                    if not table.find(data.luck, gui.Icon.Luck.Text) then
                        continue
                    end
                    luck = gui.Icon.Luck.Text
                else
                    continue -- –ü—Ä–æ–ø—É—Å–∫–∞–µ–º –µ—Å–ª–∏ –Ω–µ—Ç –Ω—É–∂–Ω—ã—Ö –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–æ–≤
                end
            end
        else
            continue -- –ü—Ä–æ–ø—É—Å–∫–∞–µ–º –µ—Å–ª–∏ –Ω–µ—Ç Display
        end
        
        if not gui or not gui:FindFirstChild("Timer") then
            continue -- –ü—Ä–æ–ø—É—Å–∫–∞–µ–º –µ—Å–ª–∏ –Ω–µ—Ç —Ç–∞–π–º–µ—Ä–∞
        end

        -- –ü–æ–∑–∏—Ü–∏—è —Ä–∏—Ñ—Ç–∞
        local position = rift:GetPivot().Position
        
        -- –ü—Ä–æ–≤–µ—Ä—è–µ–º, –±—ã–ª –ª–∏ —ç—Ç–æ—Ç —Ä–∏—Ñ—Ç —É–∂–µ –Ω–∞–π–¥–µ–Ω –∏ –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω —Ä–∞–Ω–µ–µ
        local is_cached, rift_id = isRiftCached(rift.Name, position, luck)
        if is_cached then
            print("Rift already reported:", rift_id)
            continue
        end
        
        local time = os.time() + parse_time(gui.Timer.Text);
        local discord_time = time_to_discorddate(time);
        local height = math.floor(position.Y) - 4;
        local message = {
            -- –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–µ —Ñ–æ—Ä–º–∞—Ç–∞ —É–ø–æ–º–∏–Ω–∞–Ω–∏—è —Ä–æ–ª–∏ - –ø—Ä—è–º–æ–µ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ –±–µ–∑ —Ñ–æ—Ä–º–∞—Ç–∏—Ä–æ–≤–∞–Ω–∏—è
            ['content'] = data.role_id and data.role_id ~= "" and ("<@&" .. data.role_id .. ">") or "",
            ['allowed_mentions'] = {
                ['parse'] = {"roles"}
            },
            ['embeds'] = {
                { 
                    ['title'] = string.format("**%s has been found!**", data.name), 
                    ['fields'] = {
                        {
                            ['name'] = "**‚è≤ Expires in**",
                            ['value'] = discord_time,
                            ['inline'] = true
                        },
                        {
                            ['name'] = "**üìè Height**",
                            ['value'] = string.format("`%d`", height),
                            ['inline'] = true
                        },
                        {
                            ['name'] = "**üë§ Players**",
                            ['value'] = string.format("`%d`", #players:GetPlayers()),
                            ['inline'] = true
                        },
                        {
                            ['name'] = "**üçÄ Luck**",
                            ['value'] = string.format("`%s`", luck)
                        },
                        {
                            ['name'] = "**üîó Join link**",
                            ['value'] = join_link
                        }
                    },
                    ['color'] = 4508791,
                    ['timestamp'] = DateTime.now():ToIsoDate()
                }
            }
        };

        -- –°–æ—Ö—Ä–∞–Ω—è–µ–º —Ä–∏—Ñ—Ç –≤ –≥–ª–æ–±–∞–ª—å–Ω–æ–º –∫—ç—à–µ
        cacheRift(rift_id, rift.Name)
        
        -- –û—Ç–ø—Ä–∞–≤–ª—è–µ–º –≤–µ–±—Ö—É–∫ —Å –¥–æ–±–∞–≤–ª–µ–Ω–∏–µ–º –∏–º–µ–Ω–∏ —Ä–∏—Ñ—Ç–∞ –¥–ª—è –æ—Ç–ª–∞–¥–∫–∏
        notify(data.webhook, message, rift.Name);
        rifts_sent = rifts_sent + 1
        
        -- –î–æ–±–∞–≤–ª—è–µ–º –Ω–µ–±–æ–ª—å—à—É—é –∑–∞–¥–µ—Ä–∂–∫—É –º–µ–∂–¥—É –æ—Ç–ø—Ä–∞–≤–∫–∞–º–∏ –≤–µ–±—Ö—É–∫–æ–≤
        task.wait(0.5)
    end
    
    print("Rifts found:", rifts_found, "Webhooks sent:", rifts_sent)
end

-- –û–±—Ä–∞–±–æ—Ç–∫–∞ –∫–∏–∫–∞ –æ—Ç –∏–≥—Ä—ã
game:GetService("CoreGui"):FindFirstChild("RobloxPromptGui"):FindFirstChild("promptOverlay").ChildAdded:Connect(function(child)
    debug_log("–û–±–Ω–∞—Ä—É–∂–µ–Ω–æ —Å–æ–æ–±—â–µ–Ω–∏–µ –æ—Ç –∏–≥—Ä—ã (–≤–æ–∑–º–æ–∂–Ω–æ –∫–∏–∫), –∏–Ω–∏—Ü–∏–∏—Ä—É–µ–º —Å–µ—Ä–≤–µ—Ä—Ö–æ–ø")
    safeServerhop()
end)

-- –ó–∞–ø—É—Å–∫ –Ω–µ–º–µ–¥–ª–µ–Ω–Ω–æ–≥–æ —Ö–æ–ø–∞, –µ—Å–ª–∏ –Ω–µ –±—ã–ª–∏ –Ω–∞–π–¥–µ–Ω—ã –∏–Ω—Ç–µ—Ä–µ—Å—É—é—â–∏–µ –Ω–∞—Å —Ä–∏—Ñ—Ç—ã
if not is_server_hopping then
    task.delay(5, function()
        debug_log("–ó–∞–ø—É—Å–∫ –Ω–∞—á–∞–ª—å–Ω–æ–≥–æ —Å–µ—Ä–≤–µ—Ä—Ö–æ–ø–∞ —á–µ—Ä–µ–∑ 5 —Å–µ–∫—É–Ω–¥")
        safeServerhop()
    end)
end

debug_log("–°–∫—Ä–∏–ø—Ç –ø–æ–ª–Ω–æ—Å—Ç—å—é –∑–∞–≥—Ä—É–∂–µ–Ω –∏ –∑–∞–ø—É—â–µ–Ω")
